# ~~~~~~~~~~~~~~~ Environment Variables ~~~~~~~~~~~~~~~~~~~~~~~~

export REPOS="$HOME/Repos"
export GITUSER="pedrotchang"
export GHREPOS="$REPOS/github.com/$GITUSER"
export DOTFILES="$GHREPOS/dotfiles"
export LAB="$GHREPOS/lab"
export SCRIPTS="$DOTFILES/scripts"
export SECONDBRAIN="$HOME/secondbrain"

export GOBIN="$HOME/.local/bin"
export GOPATH="$HOME/go/"

export PATH="$HOME/.local/bin:$PATH"

# ~~~~~~~~~~~~~~~ History ~~~~~~~~~~~~~~~~~~~~~~~~

HISTFILE="$HOME/.zsh_history"
HISTSIZE=80000
SAVEHIST=50000

# ~~~~~~~~~~~~~~~ Shell Options ~~~~~~~~~~~~~~~~~~~~~~~~

bindkey -v
export KEYTIMEOUT=1
setopt extended_glob null_glob

# ~~~~~~~~~~~~~~~ Completions ~~~~~~~~~~~~~~~~~~~~~~~~

{{- if eq .chezmoi.os "darwin" }}
[[ -d /opt/homebrew/share/zsh/site-functions ]] && FPATH="/opt/homebrew/share/zsh/site-functions:$FPATH"
[[ -d ~/.docker/completions ]] && fpath=(~/.docker/completions $fpath)
{{- end }}

autoload -Uz compinit && compinit

zstyle ':completion:*:*:pass:*' matcher-list 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'
zstyle ':completion:*' menu select

source <(kubectl completion zsh)
command -v flux &>/dev/null && source <(flux completion zsh)

# ~~~~~~~~~~~~~~~ Tool Initialization ~~~~~~~~~~~~~~~~~~~~~~~~

command -v mise &>/dev/null && eval "$(mise activate zsh)"
command -v starship &>/dev/null && eval "$(starship init zsh)"
command -v fzf &>/dev/null && source <(fzf --zsh)

# ~~~~~~~~~~~~~~~ Editor ~~~~~~~~~~~~~~~~~~~~~~~~

if command -v nvim &>/dev/null; then
  export EDITOR="nvim"
  export VISUAL="nvim"
fi

# ~~~~~~~~~~~~~~~ Aliases ~~~~~~~~~~~~~~~~~~~~~~~~

[[ -f ~/.config/terminal/aliases ]] && source ~/.config/terminal/aliases

# ~~~~~~~~~~~~~~~ Plugins ~~~~~~~~~~~~~~~~~~~~~~~~

[[ -f ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh ]] && source ~/.zsh/zsh-autosuggestions/zsh-autosuggestions.zsh
[[ -f ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh ]] && source ~/.zsh/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh

# ~~~~~~~~~~~~~~~ Platform Specific ~~~~~~~~~~~~~~~~~~~~~~~~

{{- if eq .chezmoi.os "darwin" }}
[[ -d /homelab ]] && cd /homelab
export PATH="/Users/seyza/.rd/bin:$PATH"
{{- end }}

# GitHub token (Linux, non-Arch only)
if [[ "$(uname)" != "Darwin" ]] && ! grep -q 'ID=arch' /etc/os-release 2>/dev/null; then
  command -v pass &>/dev/null && export GITHUB_TOKEN=$(pass github/mise-token)
fi
